# KSysGuard-Addons
Ряд файлов настроек и скриптов для KSysGuard - приложения локального мониторинга в KDE

Используется для мониторинга ИБП, GPU (на примере видеокарты NVIDIA) и управляемого свитча через SNMP в KSysGuard.

# Установка

* Для использования .pl-скриптов требуется установленный Perl

Скачайте требуемые opt-scripts уда-либо, например в /opt
* Запустите ksysguard, создайте новую вкладку, переключитесь на неё и вызовите меню Файл - мониторинг удалённого узла
* В качестве имени хоста введите любую строку, например, "My UPS", тип подключения = "другая команда"
* В поле для команды введите `perl /opt/$script_name.pl`
* !! Добавьте как минимум один сенсор от добавленного скрипта на вкладку.
  Иначе ksysguard удалит неиспользуемые источники из панели сенсоров !!
* Некоторые скрипты (например dgs1100-mon.pl) надо подредактировать - сменить IP / SNMP community и количество портов.
* Используйте шаблоны sgrd-template для создания вкладок с графиками или создайте вкладки вручную.
  Если в шаблонах отличаются имена хостов / интерфейсов - вы можете легко их поменять,
  sgrd-файлы это обычный XML.


# Добавление мониторинг видеокарты NVidia GPU в KSysGuard

В вашей системе должны быть утилиты `nvidia-smi` и `nvidia-settings` - они входят в состав проприетарного драйвера nvidia.
Скрипт мониторинга опрашивает только один (первый) GPU (предполагается домашнее/офисное использование) - для майнинговых ферм используйте решения с центральным сервером мониторинга, например  zabbix.
Выполните шаги из пункта # Установка, используя скрипт `/opt/nvmon.pl`
Добавьте вкладку из SGRD/GPU.sgrd шаблона или создайте собственную панельку.


# Добавление локального ИБП в KSysGuard

Сперва надо установить и настроить nut (Network UPS Tools). Для мониторинга нужна только утилита `upsc`.
Вызовите `upsc -l` чтобы увидеть название вашего бесперебойника ( например, ippon3000) и `upsc ippon3000` чтобы увидеть данные от ИБП.
Используйте руководства к nut для настройки.

Выполните шаги из пункта # Установка, используя скрипт `/opt/upsmon.pl`
По умолчанию скрипт мониторинг только один, первый ИБП. Если нужен второй ИБП, смотрите переменную $upc .
Добавьте вкладку из SGRD/UPS.sgrd шаблона или создайте свою.


# Добавление в KSysGuard мониторинга управляемого свитча по протоколу SNMP

SNMP огромен и обычно выдаёт кучу данных от кучи сенсоров. Но вы можете выгружать только требуемое.
Также этот пример может быть полезен для мониторинга ряда домашних/офисных/IoT устройств типа NetPing, свитчей, роутеров и прочего.

Сперва необходимо установить `snmp-tools`, скрипт опирается на использование утилиты `snmpwalk`.

Выполните шаги из пукнта # Установка, используйте скрипт `/opt/dgs1100-mon.pl` для примера.
Настройте на устройстве SNMP - установите community и права доступа.
!!! НИКОГДА не используйте значения по умолчанию !!!  SNMP должен использовать нетривиальные имена, ограничения по IP и предоставлять только минимальный доступ на чтение.

Используйте readonly-communities от свитча. Отредактируйте `/opt/dgs1100-mon.pl` - смените IP, community и число портов.
Есть пример шаблона в `SGRD/DGS-1100-10ME.sgrd` для вкладки.

Этот скрипт собирает только чмсло переданных октетов и счётчики ошибок. Для получению других парамтерво смотрите документацию на SNMP-OID. Некоторые SNMP-OID-ы могут быть вендор-специфичными - смотрите сайты производителей.


# ЧАВО

* Почему бы не использовать zabbix / nagios / grafana / другую крупную систему мониторинга ?
  - KSysGuard не заменяет большие системы мониторинга, он для простого и тривиального мониторинга в рамках ломальной машины.
    Чтобы иногда глянуть пару цифр, типа температуры и нагрузки на GPU, заряда батареи в ИБП
    и траффик на роутере, ставить сервер zabbix слишком трудоёмко, даже на микрокомпе типа распберри.
    Если вам надо толкьо разово посмотреть параметры и не нужно хранить историю зачению за большой период времени
    - используйте ksysguard локально.

* Что насчёт видеокарт AMD ?
  - У меня нет видеокарты AMD и я не в курсе, как её монитоить. Вы можете создать pull-request.

* Что такое SGRD-файлы ?
  - Это готовые щаблоны вкладок для комфортного мониторинга разных подсистем - накопителей, сети, ОС и аппаратных датчиков.
  Я использую их на моём линукс-десктопе. Перед импортом вы можете оредактировать sgrd-файл, променять имена дисков/интерфейсов
  с помощью функции найти-и-заменить в помощью тектового редактора / sed / awk / прочего.

<img src="https://user-images.githubusercontent.com/13812192/74110497-fff16d80-4b84-11ea-8b50-07e17448b464.png">

Больше инфы в моём блоге: https://aminux.wordpress.com/2020/02/10/ksysguard-add-gpu-ups-switch-snmp/
